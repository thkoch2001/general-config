#!/bin/sh

set -e

UNIT=$1
CONFIG_DIR=$(systemd-path user-configuration)
FULL_DIR=$CONFIG_DIR/require-debian-packages/$UNIT

check_package()
{
  local PACKAGE=$1
  dpkg-query --show $PACKAGE 1>/dev/null && return 0
  echo "missing package '$PACKAGE' required in file $CONFFILE"
  exit 1
}

for CONFFILE in $(find $FULL_DIR -maxdepth 1 -name "*.conf")
do
  while IFS= read -r PACKAGE; do
    case "$PACKAGE" in 
      \#*)
        continue
      ;;
      "")
        continue
      ;;
    esac
    check_package $PACKAGE
  done < "$CONFFILE"
done



#exit 1
